cmake_minimum_required(VERSION 3.10)

project(MobilePhoneProject)

# Set C++ Standard
set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Source files
set(SOURCES main.cpp MobilePhone.cpp)

# For producing the .map file
set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} /MAP")

# Create the executable
add_executable(${PROJECT_NAME} ${SOURCES})

# Create the DLL
add_library(${PROJECT_NAME}_dll SHARED ${SOURCES})

# Create the static LIB
add_library(${PROJECT_NAME}_lib STATIC ${SOURCES})

# For producing the .pdb file
set_target_properties(${PROJECT_NAME} PROPERTIES
    COMPILE_FLAGS "/Zi"
    LINK_FLAGS "/debug")

# Setting the output directory for build products
set_target_properties(${PROJECT_NAME} ${PROJECT_NAME}_dll ${PROJECT_NAME}_lib PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin"
    LIBRARY_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib"
    ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib")

# Custom command to copy .dll to .def
add_custom_command(TARGET ${PROJECT_NAME}_dll POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy
    $<TARGET_FILE_DIR:${PROJECT_NAME}_dll>/${PROJECT_NAME}_dll.dll
    $<TARGET_FILE_DIR:${PROJECT_NAME}_dll>/${PROJECT_NAME}_dll.def)

# Note:
# .o files are generated by default in the CMakeFiles directory during the build process
# .exp files are generated by default when creating a DLL
# .pdb files are produced when the "/debug" flag is set during linking
